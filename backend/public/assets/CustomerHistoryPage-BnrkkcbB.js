import{u as oe,b as ce,c as le,R as m,g as ue,d as de,e as me,f as pe,j as r,C as xe,E as ye,D as ge,h as K,I as he,Q as fe,k as Ne,S as be,m as X,n as Se}from"./index-B2UwnqKS.js";const F={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_URL:"http://localhost:3000",VITE_APP_NAME:"Comptario",VITE_APP_VERSION:"2.0.0",VITE_DEBUG_MODE:"false",VITE_DEMO_EMAIL:"demo@moneyflow.com",VITE_DEMO_PASSWORD:"demo123",VITE_EMAIL_VERIFICATION_REQUIRED:"true",VITE_ENABLE_CSP_REPORTING:"true",VITE_ENABLE_ENCRYPTION:"true",VITE_ENABLE_RATE_LIMITING:"true",VITE_ENCRYPTION_KEY:"development_encryption_key_32_chars_long_change_in_production_env",VITE_LOGIN_URL:"/login",VITE_LOG_LEVEL:"error",VITE_USE_SECURE_CRYPTO:"true"},ve=()=>{try{const c=window.location.hash.replace("#","");if(c.startsWith("customer-history:"))return c.split(":")[1]||null}catch{}return null};function Ie(){const{t:c,i18n:Z}=oe(),{formatCurrency:U}=ce(),{user:C}=le(),h=m.useMemo(()=>C&&([C.firstName,C.lastName].filter(Boolean).join(" ").trim()||C.email)||void 0,[C]);m.useEffect(()=>{h&&L(t=>{let e=!1;const a=t.map(n=>!n.createdBy||n.createdBy==="—"?(e=!0,{...n,createdBy:h}):n);return e?a:t})},[h]);const[E,ee]=m.useState(null),[S,te]=m.useState(null),[Y,L]=m.useState([]),[A,B]=m.useState(""),[R,T]=m.useState(""),[P,se]=m.useState("all"),[N,D]=m.useState("date"),[b,x]=m.useState("desc"),[j,Q]=m.useState("all"),[G,q]=m.useState(null),[W,k]=m.useState(null),[H,$]=m.useState(null),[ae,V]=m.useState(null),y=(t,e)=>{for(const u of t){const o=String(c(u)||"");if(o&&o!==u)return o}if(!e)return"";const a=(Z?.language||"en").toLowerCase(),n={"dateRanges.thisMonth":{tr:"Bu ay",en:"This month",fr:"Ce mois-ci",de:"Dieser Monat"},"dateRanges.last30Days":{tr:"Son 30 gün",en:"Last 30 days",fr:"30 derniers jours",de:"Letzte 30 Tage"},"dateRanges.thisYear":{tr:"Bu yıl",en:"This year",fr:"Cette année",de:"Dieses Jahr"},exportCSV:{tr:"CSV’e aktar",en:"Export CSV",fr:"Exporter en CSV",de:"Als CSV exportieren"},"filters.filterByStatus":{tr:"Duruma göre filtrele",en:"Filter by status",fr:"Filtrer par statut",de:"Nach Status filtern"},"filters.status":{tr:"Durum",en:"Status",fr:"Statut",de:"Status"},total:{tr:"Toplam",en:"Total",fr:"Total",de:"Gesamt"},"actions.view":{tr:"Görüntüle",en:"View",fr:"Voir",de:"Ansehen"},"actions.copyLink":{tr:"Bağlantıyı kopyala",en:"Copy link",fr:"Copier le lien",de:"Link kopieren"},"actions.downloadPDF":{tr:"PDF indir",en:"Download PDF",fr:"Télécharger le PDF",de:"PDF herunterladen"},"actions.clear":{tr:"Temizle",en:"Clear",fr:"Effacer",de:"Löschen"}},i=a.startsWith("tr")?"tr":a.startsWith("fr")?"fr":a.startsWith("de")?"de":"en";return n[e]?.[i]||""},v=t=>{const e=a=>String(a).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`},M=t=>{const e=new Date;if(t==="thisMonth"){const a=new Date(e.getFullYear(),e.getMonth(),1),n=new Date(e.getFullYear(),e.getMonth()+1,0);B(v(a)),T(v(n))}else if(t==="last30"){const a=new Date(e);a.setDate(a.getDate()-30),B(v(a)),T(v(e))}else if(t==="thisYear"){const a=new Date(e.getFullYear(),0,1),n=new Date(e.getFullYear(),11,31);B(v(a)),T(v(n))}};m.useEffect(()=>{ee(ve())},[]),m.useEffect(()=>{if(!E)return;let t=!1;return(async()=>{try{let e=null;try{const s=localStorage.getItem("tenantId")||"",d=s?`customers_cache_${s}`:"customers_cache",l=localStorage.getItem(d);if(l){const g=JSON.parse(l);Array.isArray(g)&&(e=g.find(_=>String(_.id)===String(E))||null)}}catch{}if(!e)try{e=await ue(String(E))}catch{}t||te(e);let a=[];try{a=await de()}catch{}let n=[];try{n=await me()}catch{try{const s=localStorage.getItem("tenantId")||"";if(s){const d=`sales_${s}`,l=`sales_cache_${s}`,g=localStorage.getItem(d),_=localStorage.getItem(l),I=g?JSON.parse(g):[],J=_?JSON.parse(_):[];n=[...Array.isArray(I)?I:[],...Array.isArray(J)?J:[]]}else n=[]}catch{n=[]}}let i=[];try{i=await pe()}catch{try{const s=localStorage.getItem("tenantId")||"",d=s?`quotes_cache_${s}`:"quotes_cache",l=localStorage.getItem(d),g=l?JSON.parse(l):[];Array.isArray(g)&&(i=g)}catch{}}const u=[],o=String(E),p=s=>{const d=l=>(l?.name||[l?.firstName,l?.lastName].filter(Boolean).join(" ")).trim();if(!(!s||typeof s!="object")){if(typeof s.createdBy=="string"&&s.createdBy.trim())return s.createdBy.trim();if(s.createdBy&&typeof s.createdBy=="object"){const l=d(s.createdBy);if(l)return l}if(typeof s.createdByName=="string"&&s.createdByName.trim())return s.createdByName.trim();if(s.user&&typeof s.user=="object"){const l=d(s.user);if(l)return l}if(typeof s.userName=="string"&&s.userName.trim())return s.userName.trim();if(typeof s.author=="object"){const l=d(s.author);if(l)return l}}};(a||[]).forEach(s=>{const d=String(s?.customerId||s?.customer?.id||""),l=String(s?.invoiceNumber||s?.id);if(d===o||!d&&e&&(s?.customer?.name||s?.customerName)===e.name){const g=(()=>{const I=(Array.isArray(s?.lineItems||s?.items)?s.lineItems||s.items:[])[0];if(s?.notes&&String(s.notes).trim())return String(s.notes).trim();if(I)return String(I.productName||I.description||"").trim()})();u.push({id:String(s.id),type:"invoice",name:l,date:String(s.issueDate||s.createdAt||new Date).slice(0,10),status:s.status,amount:Number(s.total||0),createdBy:p(s)||h||"—",description:g})}}),(n||[]).forEach(s=>{const d=s?.saleNumber||`SAL-${s?.id}`,l=String(s?.customerId||"");(l===o||!l&&e&&(s?.customerName===e.name||s?.customer?.name===e.name))&&u.push({id:String(s.id||d),type:"sale",name:d,date:String(s?.saleDate||s?.date||new Date).slice(0,10),status:s?.status,amount:Number(s?.amount||s?.total||0),createdBy:p(s)||h||"—",description:s?.productName||Array.isArray(s?.items)&&s.items[0]?.productName||void 0,relatedInvoiceId:s?.invoiceId?String(s.invoiceId):void 0})}),(i||[]).forEach(s=>{const d=String(s?.customerId||"");(d===o||!d&&e&&(s?.customerName===e.name||s?.customer?.name===e.name))&&u.push({id:String(s.id),type:"quote",name:s?.quoteNumber||`Q-${s?.id}`,date:String(s?.issueDate||new Date).slice(0,10),status:s?.status,amount:Number(s?.total||0),createdBy:p(s)||h||"—",description:void 0})});const f=new Map;for(const s of u){const d=`${s.type}:${s.id}`;f.has(d)||f.set(d,s)}const O=Array.from(f.values());O.sort((s,d)=>new Date(s.date).getTime()-new Date(d.date).getTime()),O.reverse(),t||L(O)}catch{}})(),()=>{t=!0}},[E,h]);const w=m.useMemo(()=>{let t=[...Y];A&&(t=t.filter(a=>a.date>=A)),R&&(t=t.filter(a=>a.date<=R)),P!=="all"&&(t=t.filter(a=>a.type===P)),j!=="all"&&(t=t.filter(a=>String(a.status||"").toLowerCase()===String(j).toLowerCase()));const e=b==="asc"?1:-1;return t.sort((a,n)=>{switch(N){case"name":return a.name.localeCompare(n.name)*e;case"status":return(a.status||"").localeCompare(n.status||"")*e;case"type":return a.type.localeCompare(n.type)*e;case"createdBy":return(a.createdBy||"").localeCompare(n.createdBy||"")*e;case"date":default:return(new Date(a.date).getTime()-new Date(n.date).getTime())*e}})},[Y,A,R,N,b,P,j]),re=m.useMemo(()=>{const t=new Set(w.filter(e=>e.type==="invoice").map(e=>String(e.id)));return w.reduce((e,a)=>a.type==="sale"&&a.relatedInvoiceId&&t.has(String(a.relatedInvoiceId))?e:e+(typeof a.amount=="number"?a.amount:0),0)},[w]),ne=(t,e)=>{const a=String(t||"").toLowerCase(),i={paid:"bg-green-100 text-green-800",completed:"bg-green-100 text-green-800",accepted:"bg-green-100 text-green-800",overdue:"bg-red-100 text-red-800",declined:"bg-red-100 text-red-800",cancelled:"bg-red-100 text-red-800",pending:"bg-amber-100 text-amber-800",sent:"bg-blue-100 text-blue-800",viewed:"bg-blue-100 text-blue-800",draft:"bg-gray-100 text-gray-800",invoiced:"bg-blue-100 text-blue-800",created:"bg-blue-100 text-blue-800",refunded:"bg-purple-100 text-purple-800",expired:"bg-orange-100 text-orange-800"}[a]||"bg-gray-100 text-gray-800",u=p=>{const f=c(p);return f===p?"":f};let o="";return e==="quote"?o=u(`quotes.statusLabels.${a}`)||u(`status.${a}`):o=u(`status.${a}`)||u(`quotes.statusLabels.${a}`),o||(o=a),r.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${i}`,children:o})},ie=t=>t==="invoice"?"text-blue-600 hover:text-blue-700":t==="sale"?"text-green-600 hover:text-green-700":"text-purple-600 hover:text-purple-700",z=async t=>{try{if(V(`${t.type}-${t.id}`),t.type==="invoice"){const e=await K(String(t.id));let a=Array.isArray(e.items)&&e.items.length>0?e.items:Array.isArray(e.lineItems)?e.lineItems:[];if(!a||a.length===0){const i=e.saleId;if(i)try{const u=await X(String(i));Array.isArray(u.items)&&(a=u.items.map(o=>({description:o.productName||o.description||"Ürün/Hizmet",quantity:Number(o.quantity)||1,unitPrice:Number(o.unitPrice)||0,total:Number(o.total??(Number(o.quantity)||1)*(Number(o.unitPrice)||0))||0,productId:o.productId})))}catch(u){console.warn("Satıştan kalem türetilemedi:",u)}}const n={id:String(e.id),invoiceNumber:e.invoiceNumber,customer:e.customer||void 0,customerName:e.customer?.name,customerEmail:e.customer?.email,total:Number(e.total)||0,subtotal:Number(e.subtotal)||0,taxAmount:Number(e.taxAmount)||0,status:e.status,issueDate:String(e.issueDate||"").slice(0,10),dueDate:String(e.dueDate||"").slice(0,10),items:Array.isArray(a)?a.map(i=>({description:i.description??i.productName??"",quantity:Number(i.quantity)||1,unitPrice:Number(i.unitPrice)||0,total:Number(i.total??(Number(i.quantity)||1)*(Number(i.unitPrice)||0))||0})):[],notes:e.notes,type:e.type};q(n)}else if(t.type==="quote"){const e=await Se(String(t.id)),a={id:String(e.id),publicId:e.publicId,quoteNumber:e.quoteNumber,customerName:e.customer?.name||e.customerName||"",customerId:e.customerId,issueDate:String(e.issueDate).slice(0,10),validUntil:e.validUntil?String(e.validUntil).slice(0,10):void 0,currency:e.currency,total:Number(e.total)||0,status:e.status,version:e.version||1,scopeOfWorkHtml:e.scopeOfWorkHtml||"",items:Array.isArray(e.items)?e.items.map(n=>({id:n.id||`${Math.random()}`,description:n.description,quantity:n.quantity,unitPrice:n.unitPrice,total:n.total,productId:n.productId,unit:n.unit})):[],revisions:Array.isArray(e.revisions)?e.revisions:[]};k(a)}else if(t.type==="sale"){const e=await X(String(t.id)),a=Array.isArray(e.items)&&e.items.length>0?e.items[0]:void 0,n=Number(e.quantity??a?.quantity??1);let i=Number(e.unitPrice??a?.unitPrice??0);(!Number.isFinite(i)||i===0)&&Number.isFinite(Number(e.total))&&n>0&&(i=Number(e.total)/n);const u={id:String(e.id),saleNumber:e.saleNumber||`SAL-${e.id}`,customerName:e.customer?.name||e.customerName||S?.name||"",customerEmail:e.customer?.email||e.customerEmail||S?.email,productName:e.productName||a?.productName||"",quantity:n,unitPrice:i,amount:Number(e.amount||e.total||n*i||0),total:Number(e.total||e.amount||n*i||0),status:e.status||"pending",date:String(e.saleDate||e.date||new Date).slice(0,10),paymentMethod:e.paymentMethod,notes:e.notes,productId:e.productId||a?.productId,productUnit:e.productUnit||a?.unit,invoiceId:e.invoiceId,items:Array.isArray(e.items)?e.items.map(o=>({productId:o.productId,productName:o.productName,quantity:o.quantity,unitPrice:o.unitPrice,total:o.total})):[]};$(u)}}catch(e){console.error("Open row failed:",e)}finally{V(null)}};return r.jsxs("div",{className:"min-h-screen bg-slate-50",children:[r.jsxs("div",{className:"w-full px-6 py-6",children:[r.jsxs("div",{className:"mb-6",children:[r.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:c("customer.historyPageTitle")||"Müşteri Geçmişi"}),r.jsx("p",{className:"text-sm text-slate-500",children:S?.name?c("customer.historySubtitle",{name:S.name}):c("customer.historyPageTitle")})]}),r.jsx("div",{className:"sticky top-0 z-30",children:r.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-4 mb-4 flex flex-col gap-3 shadow-sm",children:[r.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(xe,{className:"w-4 h-4 text-slate-500"}),r.jsx("input",{type:"date",value:A,onChange:t=>B(t.target.value),className:"border border-slate-300 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500"}),r.jsx("span",{className:"text-slate-500",children:"→"}),r.jsx("input",{type:"date",value:R,onChange:t=>T(t.target.value),className:"border border-slate-300 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500"}),r.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[r.jsx("button",{onClick:()=>M("thisMonth"),className:"px-2 py-1 text-xs rounded-full border border-slate-300 text-slate-700 hover:bg-slate-50",children:y(["common.dateRanges.thisMonth","dateRanges.thisMonth"],"dateRanges.thisMonth")}),r.jsx("button",{onClick:()=>M("last30"),className:"px-2 py-1 text-xs rounded-full border border-slate-300 text-slate-700 hover:bg-slate-50",children:y(["common.dateRanges.last30Days","dateRanges.last30Days"],"dateRanges.last30Days")}),r.jsx("button",{onClick:()=>M("thisYear"),className:"px-2 py-1 text-xs rounded-full border border-slate-300 text-slate-700 hover:bg-slate-50",children:y(["common.dateRanges.thisYear","dateRanges.thisYear"],"dateRanges.thisYear")})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[["all","invoice","sale","quote"].map(t=>r.jsx("button",{onClick:()=>se(t),className:`px-3 py-1.5 text-sm rounded-full border ${P===t?"bg-blue-600 text-white border-blue-600":"bg-white text-slate-700 border-slate-300 hover:bg-slate-50"}`,children:t==="all"?c("common.allCategories")||"Tümü":t==="invoice"?c("transactions.invoice")||"Fatura":t==="sale"?c("transactions.sale")||"Satış":c("quotes.table.quote")||"Teklif"},t)),r.jsx("button",{onClick:()=>{try{const t=["name","date","status","createdBy","type","description","amount"],e=w.map(p=>[p.name,new Date(p.date).toLocaleDateString(),p.status||"",p.createdBy||h||"",p.type,p.type==="quote"?"":p.description||"",typeof p.amount=="number"?String(p.amount):""]),a=[t,...e].map(p=>p.map(f=>`"${String(f).replace(/"/g,'""')}"`).join(",")).join(`
`),n=new Blob([a],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(n),u=document.createElement("a"),o=`customer-history-${S?.name?S.name.replace(/\s+/g,"-").toLowerCase():"export"}.csv`;u.href=i,u.download=o,u.click(),URL.revokeObjectURL(i)}catch(t){console.error("CSV export failed",t)}},className:"ml-2 px-3 py-1.5 text-sm rounded-lg bg-blue-600 text-white hover:bg-blue-700",children:y(["common.exportCSV","exportCSV"],"exportCSV")})]})]}),j!=="all"&&r.jsxs("div",{className:"mt-2",children:[r.jsxs("span",{className:"text-xs text-slate-500 mr-2",children:[y(["filters.status","common.filters.status"],"filters.status"),":"]}),r.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs rounded-full bg-blue-50 text-blue-700 border border-blue-200",children:[String(j),r.jsx("button",{onClick:()=>Q("all"),className:"ml-1 text-blue-600 hover:text-blue-800","aria-label":y(["actions.clear","common.actions.clear"],"actions.clear"),children:"×"})]})]})]})}),r.jsx("div",{className:"bg-white rounded-xl border border-slate-200 overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-slate-50",children:r.jsxs("tr",{children:[r.jsxs("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider cursor-pointer select-none",onClick:()=>D(t=>t==="name"?(x(e=>e==="asc"?"desc":"asc"),t):(x("asc"),"name")),children:[c("customer.historyColumns.name")||"İşlem Adı/No",r.jsx("span",{className:"inline-block ml-1 text-gray-400",children:N==="name"?b==="asc"?"▲":"▼":""})]}),r.jsxs("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider cursor-pointer select-none",onClick:()=>D(t=>t==="date"?(x(e=>e==="asc"?"desc":"asc"),t):(x("desc"),"date")),children:[c("customer.historyColumns.date")||"Tarih",r.jsx("span",{className:"inline-block ml-1 text-gray-400",children:N==="date"?b==="asc"?"▲":"▼":""})]}),r.jsxs("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider cursor-pointer select-none",onClick:()=>D(t=>t==="status"?(x(e=>e==="asc"?"desc":"asc"),t):(x("asc"),"status")),children:[c("customer.historyColumns.status")||"Durum",r.jsx("span",{className:"inline-block ml-1 text-gray-400",children:N==="status"?b==="asc"?"▲":"▼":""})]}),r.jsxs("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider cursor-pointer select-none",onClick:()=>D(t=>t==="createdBy"?(x(e=>e==="asc"?"desc":"asc"),t):(x("asc"),"createdBy")),children:[c("customer.historyColumns.createdBy")||"Oluşturan",r.jsx("span",{className:"inline-block ml-1 text-gray-400",children:N==="createdBy"?b==="asc"?"▲":"▼":""})]}),r.jsxs("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider cursor-pointer select-none",onClick:()=>D(t=>t==="type"?(x(e=>e==="asc"?"desc":"asc"),t):(x("asc"),"type")),children:[c("customer.historyColumns.type")||"Tür",r.jsx("span",{className:"inline-block ml-1 text-gray-400",children:N==="type"?b==="asc"?"▲":"▼":""})]}),r.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:c("customer.historyColumns.description")||c("common.description")||"Açıklama"}),r.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider",children:c("quotes.table.amount")||c("amount")||"Tutar"})]})}),r.jsxs("tbody",{className:"divide-y divide-slate-200",children:[w.map(t=>r.jsxs("tr",{className:`group hover:bg-slate-50 cursor-pointer ${ae===`${t.type}-${t.id}`?"opacity-60":""}`,onClick:()=>z(t),title:c("common.view",{defaultValue:"Görüntüle"}),children:[r.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:[r.jsx("span",{className:`${ie(t.type)}`,children:t.name}),r.jsxs("span",{className:"ml-2 inline-flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[r.jsx("button",{className:"p-1 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded",title:y(["actions.view","common.actions.view"],"actions.view"),onClick:e=>{e.stopPropagation(),z(t)},children:r.jsx(ye,{className:"w-4 h-4"})}),t.type==="invoice"&&r.jsx("button",{className:"p-1 text-slate-400 hover:text-green-600 hover:bg-green-50 rounded",title:y(["actions.downloadPDF","common.actions.downloadPDF"],"actions.downloadPDF"),onClick:async e=>{e.stopPropagation();try{V(`invoice-${t.id}-pdf`);const a=await K(String(t.id));window.dispatchEvent(new CustomEvent("download-invoice",{detail:{invoice:a}}))}catch(a){console.error("Invoice PDF download failed:",a)}finally{V(null)}},children:r.jsx(ge,{className:"w-4 h-4"})})]})]}),r.jsx("td",{className:"px-4 py-3 text-sm text-slate-700",children:new Date(t.date).toLocaleDateString()}),r.jsx("td",{className:"px-4 py-3 text-sm text-slate-700",children:r.jsx("button",{className:"hover:opacity-80",onClick:e=>{e.stopPropagation();const a=String(t.status||"").toLowerCase();a&&Q(a)},title:y(["filters.filterByStatus","common.filters.filterByStatus"],"filters.filterByStatus"),children:ne(t.status,t.type)})}),r.jsx("td",{className:"px-4 py-3 text-sm text-slate-700",children:t.createdBy||h||"—"}),r.jsx("td",{className:"px-4 py-3 text-sm text-slate-700 capitalize",children:t.type==="invoice"?c("transactions.invoice"):t.type==="sale"?c("transactions.sale"):c("quotes.table.quote")}),r.jsx("td",{className:"px-4 py-3 text-sm text-slate-700 truncate max-w-[480px]",title:t.type==="quote"?void 0:t.description||void 0,children:t.type==="quote"?"—":t.description||"—"}),r.jsx("td",{className:"px-4 py-3 text-sm text-right font-semibold text-slate-900",children:typeof t.amount=="number"?U(t.amount):"—"})]},`${t.type}:${t.id}`)),w.length===0&&r.jsx("tr",{children:r.jsx("td",{colSpan:7,className:"px-4 py-8 text-center text-slate-500",children:c("customer.noHistory")||"Geçmiş işlem bulunamadı."})})]}),r.jsx("tfoot",{children:r.jsxs("tr",{children:[r.jsx("td",{colSpan:6,className:"px-4 py-3 text-right text-xs font-medium uppercase text-slate-500",children:y(["common.total","total"],"total")}),r.jsx("td",{className:"px-4 py-3 text-sm text-right font-bold text-slate-900",children:U(re)})]})})]})})]}),r.jsx(he,{isOpen:!!G,onClose:()=>q(null),invoice:G,onEdit:t=>{try{window.dispatchEvent(new CustomEvent("open-invoice-edit",{detail:{invoice:t}}))}catch{}q(null)},onDownload:t=>{try{window.dispatchEvent(new CustomEvent("download-invoice",{detail:{invoice:t}}))}catch{}}}),r.jsx(fe,{isOpen:!!W,onClose:()=>k(null),quote:W,onEdit:t=>{try{window.dispatchEvent(new CustomEvent("open-quote-edit",{detail:{quote:t}}))}catch{}k(null)},onChangeStatus:async(t,e)=>{try{const a=await Ne(String(t.id),{status:e});k(n=>n&&n.id===t.id?{...n,status:a.status}:n),L(n=>n.map(i=>i.type==="quote"&&i.id===t.id?{...i,status:a.status}:i))}catch(a){console.error("Quote status update failed:",a)}}}),r.jsx(be,{isOpen:!!H,onClose:()=>$(null),sale:H,onEdit:t=>{try{window.dispatchEvent(new CustomEvent("open-sale-edit",{detail:{sale:t}}))}catch{}$(null)}})]})}export{Ie as default};
