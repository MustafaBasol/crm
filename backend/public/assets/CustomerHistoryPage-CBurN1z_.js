import{u as he,e as fe,f as be,R as y,r as G,b as U,l as d,g as Ne,h as Se,j as Ce,k as ve,m as n,C as we,E as je,D as De,n as ne,I as Ie,Q as Pe,o as Ae,S as qe,q as ie,t as ke}from"./index-CB_hoWrV.js";const ce=s=>typeof s=="object"&&s!==null,C=s=>typeof s!="string"?void 0:s.trim()||void 0,Q=s=>{if(!ce(s))return;const v=C(s.name),F=C(s.firstName),w=C(s.lastName),x=[F,w].filter(Boolean).join(" ").trim();return v||x||void 0||C(s.email)},J=s=>{if(ce(s))return C(s.createdBy)||Q(s.createdBy)||C(s.createdByName)||Q(s.user)||C(s.userName)||Q(s.author)||Q(s)},oe=s=>s?{id:s.id,name:s.name,email:s.email,firstName:"firstName"in s?s.firstName:void 0,lastName:"lastName"in s?s.lastName:void 0}:null,Be=s=>Array.isArray(s.items)&&s.items.length>0?s.items:Array.isArray(s.lineItems)?s.lineItems:[],Ee=s=>Array.isArray(s.items)?s.items:[],$e=s=>{switch(s){case"completed":case"invoiced":case"refunded":return"completed";case"cancelled":return"cancelled";default:return"pending"}},m=s=>{if(typeof s=="number"&&Number.isFinite(s))return s;const v=Number(s);return Number.isFinite(v)?v:0},He=()=>{if(typeof window>"u")return null;try{const s=window.location.hash.replace("#","");if(s.startsWith("customer-history:"))return s.split(":")[1]||null}catch(s){d.debug("CustomerHistoryPage: hash parse failed",s)}return null};function Re(){const{t:s,i18n:v}=he(),{formatCurrency:F}=fe(),{user:w}=be(),x=y.useMemo(()=>w&&([w.firstName,w.lastName].filter(Boolean).join(" ").trim()||w.email)||void 0,[w]);y.useEffect(()=>{x&&_(t=>{let e=!1;const r=t.map(i=>!i.createdBy||i.createdBy==="—"?(e=!0,{...i,createdBy:x}):i);return e?r:t})},[x]);const[B,le]=y.useState(null),[P,ue]=y.useState(null),[X,_]=y.useState([]),[R,T]=y.useState(""),[L,M]=y.useState(""),[V,de]=y.useState("all"),[j,E]=y.useState("date"),[D,h]=y.useState("desc"),[$,me]=y.useState("all"),[Z,K]=y.useState(null),[ee,O]=y.useState(null),[te,z]=y.useState(null),[pe,Y]=y.useState(null),N=(t,e)=>{for(const p of t){const u=String(s(p)||"");if(u&&u!==p)return u}if(!e)return"";const r=(v?.language||"en").toLowerCase(),i={"dateRanges.thisMonth":{tr:"Bu ay",en:"This month",fr:"Ce mois-ci",de:"Dieser Monat"},"dateRanges.last30Days":{tr:"Son 30 gün",en:"Last 30 days",fr:"30 derniers jours",de:"Letzte 30 Tage"},"dateRanges.thisYear":{tr:"Bu yıl",en:"This year",fr:"Cette année",de:"Dieses Jahr"},exportCSV:{tr:"CSV’e aktar",en:"Export CSV",fr:"Exporter en CSV",de:"Als CSV exportieren"},"filters.filterByStatus":{tr:"Duruma göre filtrele",en:"Filter by status",fr:"Filtrer par statut",de:"Nach Status filtern"},"filters.status":{tr:"Durum",en:"Status",fr:"Statut",de:"Status"},total:{tr:"Toplam",en:"Total",fr:"Total",de:"Gesamt"},"actions.view":{tr:"Görüntüle",en:"View",fr:"Voir",de:"Ansehen"},"actions.copyLink":{tr:"Bağlantıyı kopyala",en:"Copy link",fr:"Copier le lien",de:"Link kopieren"},"actions.downloadPDF":{tr:"PDF indir",en:"Download PDF",fr:"Télécharger le PDF",de:"PDF herunterladen"},"actions.clear":{tr:"Temizle",en:"Clear",fr:"Effacer",de:"Löschen"}},l=r.startsWith("tr")?"tr":r.startsWith("fr")?"fr":r.startsWith("de")?"de":"en";return i[e]?.[l]||""},A=t=>{const e=r=>String(r).padStart(2,"0");return`${t.getFullYear()}-${e(t.getMonth()+1)}-${e(t.getDate())}`},W=t=>{const e=new Date;if(t==="thisMonth"){const r=new Date(e.getFullYear(),e.getMonth(),1),i=new Date(e.getFullYear(),e.getMonth()+1,0);T(A(r)),M(A(i))}else if(t==="last30"){const r=new Date(e);r.setDate(r.getDate()-30),T(A(r)),M(A(e))}else if(t==="thisYear"){const r=new Date(e.getFullYear(),0,1),i=new Date(e.getFullYear(),11,31);T(A(r)),M(A(i))}};y.useEffect(()=>{le(He())},[]),y.useEffect(()=>{if(!B)return;let t=!1;return(async()=>{try{let e=null;try{const a=G()||"",c=a?`customers_cache_${a}`:"customers_cache",g=U.getItem(c);if(g){const f=JSON.parse(g);if(Array.isArray(f)){const b=f.find(I=>String(I.id)===String(B));b&&(e=oe(b))}}}catch(a){d.debug("CustomerHistoryPage: customer cache parse failed",a)}if(!e)try{const a=await Ne(String(B));e=oe(a)}catch(a){d.warn("CustomerHistoryPage: customer fetch failed",a)}t||ue(e);let r=[];try{r=await Se()}catch(a){d.warn("CustomerHistoryPage: invoices fetch failed",a)}let i=[];try{i=await Ce()}catch(a){d.warn("CustomerHistoryPage: sales fetch failed, attempting cache",a);try{const c=G()||"";if(c){const g=`sales_${c}`,f=`sales_cache_${c}`,b=U.getItem(g),I=U.getItem(f),ae=b?JSON.parse(b):[],re=I?JSON.parse(I):[];i=[...Array.isArray(ae)?ae:[],...Array.isArray(re)?re:[]]}}catch(c){d.debug("CustomerHistoryPage: sales cache fallback failed",c),i=[]}}let l=[];try{l=await ve()}catch(a){d.warn("CustomerHistoryPage: quotes fetch failed, attempting cache",a);try{const c=G()||"",g=c?`quotes_cache_${c}`:"quotes_cache",f=U.getItem(g),b=f?JSON.parse(f):[];Array.isArray(b)&&(l=b)}catch(c){d.debug("CustomerHistoryPage: quotes cache fallback failed",c)}}const p=[],u=String(B),o=e?.name;r.forEach(a=>{if(!a)return;const c=String(a.customerId??a.customer?.id??""),g=String(a.invoiceNumber??a.id??"");if(d.debug("[CustomerHistory] invoice mapping",{id:a.id,currentUserName:x}),c===u||!c&&o&&(a.customer?.name===o||a.customerName===o)){const f=Be(a),b=(()=>{if(a.notes&&String(a.notes).trim())return String(a.notes).trim();const I=f[0];return C(I?.productName)||C(I?.description)})();p.push({id:String(a.id??g),type:"invoice",name:g,date:String(a.issueDate??a.createdAt??new Date).slice(0,10),status:a.status,amount:Number(a.total??0),createdBy:J(a)||x||"—",description:b})}}),i.forEach(a=>{if(!a)return;const c=a.saleNumber||(a.id?`SAL-${a.id}`:"Sale"),g=String(a.customerId??"");d.debug("[CustomerHistory] sale mapping",{id:a.id,currentUserName:x}),(g===u||!g&&o&&(a.customerName===o||a.customer?.name===o))&&p.push({id:String(a.id??c),type:"sale",name:c,date:String(a.saleDate??a.date??new Date).slice(0,10),status:a.status,amount:Number(a.amount??a.total??0),createdBy:J(a)||x||"—",description:a.productName||(Ee(a)[0]?.productName??void 0),relatedInvoiceId:a.invoiceId?String(a.invoiceId):void 0})}),l.forEach(a=>{if(!a)return;const c=String(a.customerId??"");d.debug("[CustomerHistory] quote mapping",{id:a.id,currentUserName:x}),(c===u||!c&&o&&(a.customerName===o||a.customer?.name===o))&&p.push({id:String(a.id??`quote-${Date.now()}`),type:"quote",name:a.quoteNumber||`Q-${a.id??p.length+1}`,date:String(a.issueDate??new Date).slice(0,10),status:a.status,amount:Number(a.total??0),createdBy:J(a)||x||"—",description:void 0})});const S=new Map;p.forEach(a=>{const c=`${a.type}:${a.id}`;S.has(c)||S.set(c,a)});const k=Array.from(S.values());k.sort((a,c)=>new Date(a.date).getTime()-new Date(c.date).getTime()),k.reverse(),t||_(k)}catch(e){d.error("CustomerHistoryPage: failed to load customer history",e)}})(),()=>{t=!0}},[B,x]);const H=t=>t?String(t).trim().toLowerCase().replace(/^status\./,""):"",q=y.useMemo(()=>{let t=[...X];R&&(t=t.filter(r=>r.date>=R)),L&&(t=t.filter(r=>r.date<=L)),V!=="all"&&(t=t.filter(r=>r.type===V)),$!=="all"&&(t=t.filter(r=>H(r.status)===H($)));const e=D==="asc"?1:-1;return t.sort((r,i)=>{switch(j){case"name":return r.name.localeCompare(i.name)*e;case"status":return H(r.status).localeCompare(H(i.status))*e;case"type":return r.type.localeCompare(i.type)*e;case"createdBy":return(r.createdBy||"").localeCompare(i.createdBy||"")*e;case"date":default:return(new Date(r.date).getTime()-new Date(i.date).getTime())*e}})},[X,R,L,j,D,V,$]),ye=y.useMemo(()=>{const t=new Set(q.filter(e=>e.type==="invoice").map(e=>String(e.id)));return q.reduce((e,r)=>r.type==="sale"&&r.relatedInvoiceId&&t.has(String(r.relatedInvoiceId))?e:e+(typeof r.amount=="number"?r.amount:0),0)},[q]),ge=(t,e)=>{const r=H(t),l={paid:"bg-green-100 text-green-800",completed:"bg-green-100 text-green-800",accepted:"bg-green-100 text-green-800",overdue:"bg-red-100 text-red-800",declined:"bg-red-100 text-red-800",cancelled:"bg-red-100 text-red-800",pending:"bg-amber-100 text-amber-800",sent:"bg-blue-100 text-blue-800",viewed:"bg-blue-100 text-blue-800",draft:"bg-gray-100 text-gray-800",invoiced:"bg-blue-100 text-blue-800",created:"bg-blue-100 text-blue-800",refunded:"bg-purple-100 text-purple-800",expired:"bg-orange-100 text-orange-800"}[r]||"bg-gray-100 text-gray-800",u=(()=>{if(!r)return s("status.unknown",{defaultValue:"Bilinmiyor"});if(e==="quote"){const c=`quotes.statusLabels.${r}`,g=s(c);if(g&&g!==c)return g}const o=`common:status.${r}`,S=s(o);if(S&&S!==o)return S;const k=`status.${r}`,a=s(k);return a&&a!==k?a:r})();return n.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${l}`,children:u})},xe=t=>t==="invoice"?"text-blue-600 hover:text-blue-700":t==="sale"?"text-green-600 hover:text-green-700":"text-purple-600 hover:text-purple-700",se=async t=>{try{if(Y(`${t.type}-${t.id}`),t.type==="invoice"){const e=await ne(String(t.id)),r=e;let i=Array.isArray(r.items)&&r.items.length>0?r.items:Array.isArray(e.lineItems)?e.lineItems:[];if(i.length===0&&e.saleId)try{const u=await ie(String(e.saleId));Array.isArray(u.items)&&(i=u.items.map(o=>({description:o.productName||o.description||"Ürün/Hizmet",quantity:m(o.quantity??1),unitPrice:m(o.unitPrice??0),total:m(o.total??m(o.unitPrice??0)*m(o.quantity??1)),productId:o.productId})))}catch(u){d.warn("CustomerHistoryPage: unable to derive invoice items from sale",u)}const l=e.customer?{id:e.customer.id,name:e.customer.name,email:e.customer.email}:void 0,p={id:String(e.id),invoiceNumber:e.invoiceNumber,customer:l,customerName:e.customer?.name,customerEmail:e.customer?.email,total:m(e.total),subtotal:m(e.subtotal),taxAmount:m(e.taxAmount),status:e.status,issueDate:String(e.issueDate||"").slice(0,10),dueDate:String(e.dueDate||"").slice(0,10),items:i.map(u=>({description:u.description??u.productName??"",quantity:m(u.quantity??1),unitPrice:m(u.unitPrice??0),total:m(u.total??m(u.unitPrice??0)*m(u.quantity??1))})),notes:e.notes,type:e.type};K(p)}else if(t.type==="quote"){const e=await ke(String(t.id)),r={id:String(e.id),publicId:e.publicId,quoteNumber:e.quoteNumber,customerName:e.customer?.name||e.customerName||"",customerId:e.customerId,issueDate:String(e.issueDate).slice(0,10),validUntil:e.validUntil?String(e.validUntil).slice(0,10):void 0,currency:e.currency,total:Number(e.total)||0,status:e.status,version:e.version||1,scopeOfWorkHtml:e.scopeOfWorkHtml||"",items:Array.isArray(e.items)?e.items.map((i,l)=>({id:String(i.id??`quote-item-${l}`),description:i.description,quantity:i.quantity,unitPrice:i.unitPrice,total:i.total,productId:i.productId,unit:i.unit})):[],revisions:Array.isArray(e.revisions)?e.revisions:[]};O(r)}else if(t.type==="sale"){const e=await ie(String(t.id)),r=Array.isArray(e.items)&&e.items.length>0?e.items[0]:void 0,i=m(e.quantity??r?.quantity??1);let l=m(e.unitPrice??r?.unitPrice??0);const p=m(e.total??e.amount??i*l);(l===0||!Number.isFinite(l))&&p>0&&i>0&&(l=p/i);const u={id:String(e.id),saleNumber:e.saleNumber||`SAL-${e.id}`,customerName:e.customer?.name||e.customerName||P?.name||"",customerEmail:e.customer?.email||e.customerEmail||P?.email,productName:e.productName||r?.productName||"",quantity:i,unitPrice:l||0,amount:p||i*l,total:p||i*l,status:$e(e.status),date:String(e.saleDate||e.date||new Date).slice(0,10),paymentMethod:e.paymentMethod,notes:e.notes,productId:e.productId||r?.productId,productUnit:e.productUnit||r?.unit,invoiceId:e.invoiceId,items:Array.isArray(e.items)?e.items.map(o=>({productId:o.productId,productName:o.productName||"",quantity:m(o.quantity),unitPrice:m(o.unitPrice),total:m(o.total??m(o.unitPrice)*m(o.quantity))})):[]};z(u)}}catch(e){d.error("CustomerHistoryPage: openRow failed",e)}finally{Y(null)}};return n.jsxs("div",{className:"min-h-screen bg-slate-50",children:[n.jsxs("div",{className:"w-full px-6 py-6",children:[n.jsxs("div",{className:"mb-6",children:[n.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:s("customer.historyPageTitle")||"Hesap Geçmişi"}),n.jsx("p",{className:"text-sm text-slate-500",children:P?.name?s("customer.historySubtitle",{name:P.name}):s("customer.historyPageTitle")})]}),n.jsx("div",{className:"sticky top-0 z-30",children:n.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-4 mb-4 flex flex-col gap-3 shadow-sm",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(we,{className:"w-4 h-4 text-slate-500"}),n.jsx("input",{type:"date",value:R,onChange:t=>T(t.target.value),className:"border border-slate-300 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500"}),n.jsx("span",{className:"text-slate-500",children:"→"}),n.jsx("input",{type:"date",value:L,onChange:t=>M(t.target.value),className:"border border-slate-300 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500"}),n.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[n.jsx("button",{onClick:()=>W("thisMonth"),className:"px-2 py-1 text-xs rounded-full border border-slate-300 text-slate-700 hover:bg-slate-50",children:N(["common.dateRanges.thisMonth","dateRanges.thisMonth"],"dateRanges.thisMonth")}),n.jsx("button",{onClick:()=>W("last30"),className:"px-2 py-1 text-xs rounded-full border border-slate-300 text-slate-700 hover:bg-slate-50",children:N(["common.dateRanges.last30Days","dateRanges.last30Days"],"dateRanges.last30Days")}),n.jsx("button",{onClick:()=>W("thisYear"),className:"px-2 py-1 text-xs rounded-full border border-slate-300 text-slate-700 hover:bg-slate-50",children:N(["common.dateRanges.thisYear","dateRanges.thisYear"],"dateRanges.thisYear")})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[["all","invoice","sale","quote"].map(t=>n.jsx("button",{onClick:()=>de(t),className:`px-3 py-1.5 text-sm rounded-full border ${V===t?"bg-blue-600 text-white border-blue-600":"bg-white text-slate-700 border-slate-300 hover:bg-slate-50"}`,children:t==="all"?s("common.allCategories")||"Tümü":t==="invoice"?s("transactions.invoice")||"Fatura":t==="sale"?s("transactions.sale")||"Satış":s("quotes.table.quote")||"Teklif"},t)),n.jsx("button",{onClick:()=>{try{const t=["name","date","status","createdBy","type","description","amount"],e=q.map(o=>[o.name,new Date(o.date).toLocaleDateString(),o.status||"",o.createdBy||x||"",o.type,o.type==="quote"?"":o.description||"",typeof o.amount=="number"?String(o.amount):""]),r=[t,...e].map(o=>o.map(S=>`"${String(S).replace(/"/g,'""')}"`).join(",")).join(`
`),i=new Blob([r],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(i),p=document.createElement("a"),u=`customer-history-${P?.name?P.name.replace(/\s+/g,"-").toLowerCase():"export"}.csv`;p.href=l,p.download=u,p.click(),URL.revokeObjectURL(l)}catch(t){d.error("CustomerHistoryPage: CSV export failed",t)}},className:"ml-2 px-3 py-1.5 text-sm rounded-lg bg-blue-600 text-white hover:bg-blue-700",children:N(["common.exportCSV","exportCSV"],"exportCSV")})]})]}),$!=="all"&&n.jsxs("div",{className:"mt-2",children:[n.jsxs("span",{className:"text-xs text-slate-500 mr-2",children:[N(["filters.status","common.filters.status"],"filters.status"),":"]}),n.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs rounded-full bg-blue-50 text-blue-700 border border-blue-200",children:[String($),n.jsx("button",{onClick:()=>me("all"),className:"ml-1 text-blue-600 hover:text-blue-800","aria-label":N(["actions.clear","common.actions.clear"],"actions.clear"),children:"×"})]})]})]})}),n.jsx("div",{className:"bg-white rounded-xl border border-slate-200 overflow-x-auto",children:n.jsxs("table",{className:"w-full",children:[n.jsx("thead",{className:"bg-slate-50",children:n.jsxs("tr",{children:[n.jsxs("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider cursor-pointer select-none",onClick:()=>E(t=>t==="name"?(h(e=>e==="asc"?"desc":"asc"),t):(h("asc"),"name")),children:[s("customer.historyColumns.name")||"İşlem Adı/No",n.jsx("span",{className:"inline-block ml-1 text-gray-400",children:j==="name"?D==="asc"?"▲":"▼":""})]}),n.jsxs("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider cursor-pointer select-none",onClick:()=>E(t=>t==="date"?(h(e=>e==="asc"?"desc":"asc"),t):(h("desc"),"date")),children:[s("customer.historyColumns.date")||"Tarih",n.jsx("span",{className:"inline-block ml-1 text-gray-400",children:j==="date"?D==="asc"?"▲":"▼":""})]}),n.jsxs("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider cursor-pointer select-none",onClick:()=>E(t=>t==="status"?(h(e=>e==="asc"?"desc":"asc"),t):(h("asc"),"status")),children:[s("customer.historyColumns.status")||"Durum",n.jsx("span",{className:"inline-block ml-1 text-gray-400",children:j==="status"?D==="asc"?"▲":"▼":""})]}),n.jsxs("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider cursor-pointer select-none",onClick:()=>E(t=>t==="createdBy"?(h(e=>e==="asc"?"desc":"asc"),t):(h("asc"),"createdBy")),children:[s("customer.historyColumns.createdBy")||"Oluşturan",n.jsx("span",{className:"inline-block ml-1 text-gray-400",children:j==="createdBy"?D==="asc"?"▲":"▼":""})]}),n.jsxs("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider cursor-pointer select-none",onClick:()=>E(t=>t==="type"?(h(e=>e==="asc"?"desc":"asc"),t):(h("asc"),"type")),children:[s("customer.historyColumns.type")||"Tür",n.jsx("span",{className:"inline-block ml-1 text-gray-400",children:j==="type"?D==="asc"?"▲":"▼":""})]}),n.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:s("customer.historyColumns.description")||s("common.description")||"Açıklama"}),n.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider",children:s("quotes.table.amount")||s("amount")||"Tutar"})]})}),n.jsxs("tbody",{className:"divide-y divide-slate-200",children:[q.map(t=>n.jsxs("tr",{className:`group hover:bg-slate-50 cursor-pointer ${pe===`${t.type}-${t.id}`?"opacity-60":""}`,onClick:()=>se(t),title:s("common.view",{defaultValue:"Görüntüle"}),children:[n.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:[n.jsx("span",{className:`${xe(t.type)}`,children:t.name}),n.jsxs("span",{className:"ml-2 inline-flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx("button",{className:"p-1 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded",title:N(["actions.view","common.actions.view"],"actions.view"),onClick:e=>{e.stopPropagation(),se(t)},children:n.jsx(je,{className:"w-4 h-4"})}),t.type==="invoice"&&n.jsx("button",{className:"p-1 text-slate-400 hover:text-green-600 hover:bg-green-50 rounded",title:N(["actions.downloadPDF","common.actions.downloadPDF"],"actions.downloadPDF"),onClick:async e=>{e.stopPropagation();try{Y(`invoice-${t.id}-pdf`);const r=await ne(String(t.id));try{window.dispatchEvent(new CustomEvent("download-invoice",{detail:{invoice:r}}))}catch(i){d.debug("CustomerHistoryPage: inline invoice download dispatch failed",i)}}catch(r){d.error("CustomerHistoryPage: invoice PDF download failed",r)}finally{Y(null)}},children:n.jsx(De,{className:"w-4 h-4"})})]})]}),n.jsx("td",{className:"px-4 py-3 text-sm text-slate-700",children:new Date(t.date).toLocaleDateString()}),n.jsx("td",{className:"px-4 py-3 text-sm text-slate-700",children:ge(t.status,t.type)}),n.jsx("td",{className:"px-4 py-3 text-sm text-slate-700",children:t.createdBy||x||"—"}),n.jsx("td",{className:"px-4 py-3 text-sm text-slate-700 capitalize",children:t.type==="invoice"?s("transactions.invoice"):t.type==="sale"?s("transactions.sale"):s("quotes.table.quote")}),n.jsx("td",{className:"px-4 py-3 text-sm text-slate-700 truncate max-w-[480px]",title:t.type==="quote"?void 0:t.description||void 0,children:t.type==="quote"?"—":t.description||"—"}),n.jsx("td",{className:"px-4 py-3 text-sm text-right font-semibold text-slate-900",children:typeof t.amount=="number"?F(t.amount):"—"})]},`${t.type}:${t.id}`)),q.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"px-4 py-8 text-center text-slate-500",children:s("customer.noHistory")||"Geçmiş işlem bulunamadı."})})]}),n.jsx("tfoot",{children:n.jsxs("tr",{children:[n.jsx("td",{colSpan:6,className:"px-4 py-3 text-right text-xs font-medium uppercase text-slate-500",children:N(["common.total","total"],"total")}),n.jsx("td",{className:"px-4 py-3 text-sm text-right font-bold text-slate-900",children:F(ye)})]})})]})})]}),n.jsx(Ie,{isOpen:!!Z,onClose:()=>K(null),invoice:Z,onEdit:t=>{try{window.dispatchEvent(new CustomEvent("open-invoice-edit",{detail:{invoice:t}}))}catch(e){d.debug("CustomerHistoryPage: invoice edit event dispatch failed",e)}K(null)},onDownload:t=>{try{window.dispatchEvent(new CustomEvent("download-invoice",{detail:{invoice:t}}))}catch(e){d.debug("CustomerHistoryPage: invoice download event dispatch failed",e)}}}),n.jsx(Pe,{isOpen:!!ee,onClose:()=>O(null),quote:ee,onEdit:t=>{try{window.dispatchEvent(new CustomEvent("open-quote-edit",{detail:{quote:t}}))}catch(e){d.debug("CustomerHistoryPage: quote edit event dispatch failed",e)}O(null)},onChangeStatus:async(t,e)=>{try{const r=await Ae(String(t.id),{status:e});O(i=>i&&i.id===t.id?{...i,status:r.status}:i),_(i=>i.map(l=>l.type==="quote"&&l.id===t.id?{...l,status:r.status}:l))}catch(r){d.error("CustomerHistoryPage: quote status update failed",r)}}}),n.jsx(qe,{isOpen:!!te,onClose:()=>z(null),sale:te,onEdit:t=>{try{window.dispatchEvent(new CustomEvent("open-sale-edit",{detail:{sale:t}}))}catch(e){d.debug("CustomerHistoryPage: sale edit event dispatch failed",e)}z(null)}})]})}export{Re as default};
